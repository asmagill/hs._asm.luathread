5d4
< #import "../../LuaSkinThread.h"
28c27
<     LuaSkin *skin = LST_getLuaSkin(); //[LuaSkin shared] ;
---
>     LuaSkin *skin = [LuaSkin shared];
33c32
<     [skin pushLuaRef:LST_getRefTable(skin, USERDATA_TAG, refTable) ref:t->fn];
---
>     [skin pushLuaRef:refTable ref:t->fn];
53c52
<     LuaSkin *skin = LST_getLuaSkin(); //[LuaSkin shared] ;
---
>     LuaSkin *skin = [LuaSkin shared];
60c59
<     watcher->fn = [skin luaRef:LST_getRefTable(skin, USERDATA_TAG, refTable)];
---
>     watcher->fn = [skin luaRef:refTable];
88c87
<     CFRunLoopAddSource(CFRunLoopGetCurrent(), watcher->t, kCFRunLoopCommonModes);
---
>     CFRunLoopAddSource(CFRunLoopGetMain(), watcher->t, kCFRunLoopCommonModes);
108c107
<     CFRunLoopRemoveSource(CFRunLoopGetCurrent(), watcher->t, kCFRunLoopCommonModes);
---
>     CFRunLoopRemoveSource(CFRunLoopGetMain(), watcher->t, kCFRunLoopCommonModes);
113c112
<     LuaSkin *skin = LST_getLuaSkin(); //[LuaSkin shared] ;
---
>     LuaSkin *skin = [LuaSkin shared];
119c118
<     watcher->fn = [skin luaUnref:LST_getRefTable(skin, USERDATA_TAG, refTable) ref:watcher->fn];
---
>     watcher->fn = [skin luaUnref:refTable ref:watcher->fn];
156,162c155,156
<     LuaSkin *skin = LST_getLuaSkin(); //[LuaSkin shared] ;
< 
<     LST_setRefTable(skin, USERDATA_TAG, refTable,
<         [skin registerLibraryWithObject:USERDATA_TAG
<                               functions:batteryLib
<                           metaFunctions:meta_gcLib
<                         objectFunctions:battery_metalib]) ;
---
>     LuaSkin *skin = [LuaSkin shared];
>     refTable = [skin registerLibraryWithObject:USERDATA_TAG functions:batteryLib metaFunctions:meta_gcLib objectFunctions:battery_metalib];
