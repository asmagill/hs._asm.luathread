5d4
< #import "../../LuaSkinThread.h"
33c32
< // static dispatch_queue_t notificationQueue;
---
> static dispatch_queue_t notificationQueue;
45c44
<     LuaSkin *skin = LST_getLuaSkin();
---
>     LuaSkin *skin = [LuaSkin shared];
64c63
<     LuaSkin *skin = LST_getLuaSkin();
---
>     LuaSkin *skin = [LuaSkin shared];
68c67
<     CGDirectDisplayID screen_id = [[[screen deviceDescription] objectForKey:@"NSScreenNumber"] unsignedIntValue];
---
>     CGDirectDisplayID screen_id = [[[screen deviceDescription] objectForKey:@"NSScreenNumber"] intValue];
70,71d68
< #pragma clang diagnostic push
< #pragma clang diagnostic ignored "-Wdeprecated-declarations"
73d69
< #pragma clang diagnostic pop
125c121
<     LuaSkin *skin = LST_getLuaSkin();
---
>     LuaSkin *skin = [LuaSkin shared];
129c125
<     CGDirectDisplayID screen_id = [[[screen deviceDescription] objectForKey:@"NSScreenNumber"] unsignedIntValue];
---
>     CGDirectDisplayID screen_id = [[[screen deviceDescription] objectForKey:@"NSScreenNumber"] intValue];
169c165
<     LuaSkin *skin = LST_getLuaSkin();
---
>     LuaSkin *skin = [LuaSkin shared];
173c169
<     CGDirectDisplayID screen_id = [[[screen deviceDescription] objectForKey:@"NSScreenNumber"] unsignedIntValue];
---
>     CGDirectDisplayID screen_id = [[[screen deviceDescription] objectForKey:@"NSScreenNumber"] intValue];
221c217
<     LuaSkin *skin = LST_getLuaSkin();
---
>     LuaSkin *skin = [LuaSkin shared];
228c224
<     CGDirectDisplayID screen_id = [[[screen deviceDescription] objectForKey:@"NSScreenNumber"] unsignedIntValue];
---
>     CGDirectDisplayID screen_id = [[[screen deviceDescription] objectForKey:@"NSScreenNumber"] intValue];
269c265
<     LuaSkin *skin = LST_getLuaSkin();
---
>     LuaSkin *skin = [LuaSkin shared];
291c287
<     LuaSkin *skin = LST_getLuaSkin();
---
>     LuaSkin *skin = [LuaSkin shared];
295c291
<     CGDirectDisplayID screen_id = [[[screen deviceDescription] objectForKey:@"NSScreenNumber"] unsignedIntValue];
---
>     CGDirectDisplayID screen_id = [[[screen deviceDescription] objectForKey:@"NSScreenNumber"] intValue];
355c351
<     LuaSkin *skin = LST_getLuaSkin();
---
>     LuaSkin *skin = [LuaSkin shared];
358c354
< //     int i = 0;
---
>     int i = 0;
370c366
<         for (NSUInteger i = 0; i < capacity; i++) {
---
>         for (i = 0; i < (int)capacity; i++) {
380c376
<         [originalGammas setObject:gammas forKey:[NSNumber numberWithUnsignedInt:display]];
---
>         [originalGammas setObject:gammas forKey:[NSNumber numberWithInt:display]];
456,457c452,453
<         [originalGammas removeObjectForKey:[NSNumber numberWithUnsignedInt:display]];
<         [currentGammas removeObjectForKey:[NSNumber numberWithUnsignedInt:display]];
---
>         [originalGammas removeObjectForKey:[NSNumber numberWithInt:display]];
>         [currentGammas removeObjectForKey:[NSNumber numberWithInt:display]];
460c456
<         [currentGammas removeObjectForKey:[NSNumber numberWithUnsignedInt:display]];
---
>         [currentGammas removeObjectForKey:[NSNumber numberWithInt:display]];
468d463
< // NOTE: no luaskin/lua activity takes place in this function, so mainthread should be fine...
496c491
<     LuaSkin *skin = LST_getLuaSkin();
---
>     LuaSkin *skin = [LuaSkin shared];
500c495
<     CGDirectDisplayID screen_id = [[[screen deviceDescription] objectForKey:@"NSScreenNumber"] unsignedIntValue];
---
>     CGDirectDisplayID screen_id = [[[screen deviceDescription] objectForKey:@"NSScreenNumber"] intValue];
507c502
<     whitePoint[0] = (float)lua_tonumber(L, -1);
---
>     whitePoint[0] = lua_tonumber(L, -1);
511c506
<     whitePoint[1] = (float)lua_tonumber(L, -1);
---
>     whitePoint[1] = lua_tonumber(L, -1);
515c510
<     whitePoint[2] = (float)lua_tonumber(L, -1);
---
>     whitePoint[2] = lua_tonumber(L, -1);
519c514
<     blackPoint[0] = (float)lua_tonumber(L, -1);
---
>     blackPoint[0] = lua_tonumber(L, -1);
523c518
<     blackPoint[1] = (float)lua_tonumber(L, -1);
---
>     blackPoint[1] = lua_tonumber(L, -1);
527c522
<     blackPoint[2] = (float)lua_tonumber(L, -1);
---
>     blackPoint[2] = lua_tonumber(L, -1);
531c526
<     NSDictionary *originalGamma = [originalGammas objectForKey:[NSNumber numberWithUnsignedInt:screen_id]];
---
>     NSDictionary *originalGamma = [originalGammas objectForKey:[NSNumber numberWithInt:screen_id]];
540c535
<     NSUInteger count = [redArray count];
---
>     int count = (int)[redArray count];
551c546
<     for (NSUInteger i = 0; i < count; i++) {
---
>     for (int i = 0; i < count; i++) {
572c567
<         [currentGammas setObject:gammas forKey:[NSNumber numberWithUnsignedInt:screen_id]];
---
>         [currentGammas setObject:gammas forKey:[NSNumber numberWithInt:screen_id]];
577c572
<     CGError result = CGSetDisplayTransferByTable(screen_id, (uint32)count, redTable, greenTable, blueTable);
---
>     CGError result = CGSetDisplayTransferByTable(screen_id, count, redTable, greenTable, blueTable);
603c598
<     LuaSkin *skin = LST_getLuaSkin();
---
>     LuaSkin *skin = [LuaSkin shared];
607,609c602
<     CGDirectDisplayID screen_id = [[[screen deviceDescription] objectForKey:@"NSScreenNumber"] unsignedIntValue];
< #pragma clang diagnostic push
< #pragma clang diagnostic ignored "-Wdeprecated-declarations"
---
>     CGDirectDisplayID screen_id = [[[screen deviceDescription] objectForKey:@"NSScreenNumber"] intValue];
611d603
< #pragma clang diagnostic pop
634c626
<     LuaSkin *skin = LST_getLuaSkin();
---
>     LuaSkin *skin = [LuaSkin shared];
638,640c630
<     CGDirectDisplayID screen_id = [[[screen deviceDescription] objectForKey:@"NSScreenNumber"] unsignedIntValue];
< #pragma clang diagnostic push
< #pragma clang diagnostic ignored "-Wdeprecated-declarations"
---
>     CGDirectDisplayID screen_id = [[[screen deviceDescription] objectForKey:@"NSScreenNumber"] intValue];
642d631
< #pragma clang diagnostic pop
644c633
<     IODisplaySetFloatParameter(service, kNilOptions, CFSTR(kIODisplayBrightnessKey), (float)lua_tonumber(L, 2));
---
>     IODisplaySetFloatParameter(service, kNilOptions, CFSTR(kIODisplayBrightnessKey), lua_tonumber(L, 2));
651,652c640,641
< //     LuaSkin *skin = LST_getLuaSkin();
<     NSDictionary *gammas = [currentGammas objectForKey:[NSNumber numberWithUnsignedInt:display]];
---
>     LuaSkin *skin = [LuaSkin shared];
>     NSDictionary *gammas = [currentGammas objectForKey:[NSNumber numberWithInt:display]];
661c650
<     NSUInteger count = [red count];
---
>     int count = (int)[red count];
667c656
<     for (NSUInteger i = 0; i < count; i++) {
---
>     for (int i = 0; i < count; i++) {
673c662
<     CGError result = CGSetDisplayTransferByTable(display, (uint32)count, redTable, greenTable, blueTable);
---
>     CGError result = CGSetDisplayTransferByTable(display, count, redTable, greenTable, blueTable);
676c665
<         [LuaSkin logBreadcrumb:[NSString stringWithFormat:@"hs._asm.luathreaad: screen_gammaReapply: ERROR: %i on display: %i", result, display]];
---
>         [skin logBreadcrumb:[NSString stringWithFormat:@"screen_gammaReapply: ERROR: %i on display: %i", result, display]];
718c707
<     LuaSkin *skin = LST_getLuaSkin();
---
>     LuaSkin *skin = [LuaSkin shared];
743c732
<     LuaSkin *skin = LST_getLuaSkin();
---
>     LuaSkin *skin = [LuaSkin shared];
761c750
<     LuaSkin *skin = LST_getLuaSkin();
---
>     LuaSkin *skin = [LuaSkin shared];
791,792c780,781
<     deltaX = (int)(-CGRectGetMinX(CGDisplayBounds(targetDisplay)));
<     deltaY = (int)(-CGRectGetMinY(CGDisplayBounds(targetDisplay)));
---
>     deltaX = -CGRectGetMinX(CGDisplayBounds(targetDisplay));
>     deltaY = -CGRectGetMinY(CGDisplayBounds(targetDisplay));
805,806c794,795
<                                         (int)CGRectGetMinX(CGDisplayBounds(dID)) + deltaX,
<                                         (int)CGRectGetMinY(CGDisplayBounds(dID)) + deltaY
---
>                                         CGRectGetMinX(CGDisplayBounds(dID)) + deltaX,
>                                         CGRectGetMinY(CGDisplayBounds(dID)) + deltaY
838c827
<     LuaSkin *skin = LST_getLuaSkin();
---
>     LuaSkin *skin = [LuaSkin shared];
882,883d870
< #pragma clang diagnostic push
< #pragma clang diagnostic ignored "-Wdeprecated-declarations"
885,886c872
< #pragma clang diagnostic pop
<             IOOptionBits options = (IOOptionBits)(kIOFBSetTransform | (rotation) << 16);
---
>             IOOptionBits options = (kIOFBSetTransform | (rotation) << 16);
975c961
<     LuaSkin *skin = LST_getLuaSkin();
---
>     LuaSkin *skin = [LuaSkin shared];
991c977
<     LuaSkin *skin = LST_getLuaSkin();
---
>     LuaSkin *skin = [LuaSkin shared];
1001c987
<     LuaSkin *skin = LST_getLuaSkin();
---
>     LuaSkin *skin = [LuaSkin shared];
1005c991
<     CGDirectDisplayID screen_id = [[[screen deviceDescription] objectForKey:@"NSScreenNumber"] unsignedIntValue];
---
>     CGDirectDisplayID screen_id = [[[screen deviceDescription] objectForKey:@"NSScreenNumber"] intValue];
1007,1008d992
< #pragma clang diagnostic push
< #pragma clang diagnostic ignored "-Wdeprecated-declarations"
1010d993
< #pragma clang diagnostic pop
1061c1044
<     LuaSkin *skin = LST_getLuaSkin();
---
>     LuaSkin *skin = [LuaSkin shared];
1067c1050
< //     notificationQueue = dispatch_queue_create("org.hammerspoon.Hammerspoon.gammaReapplyNotificationQueue", NULL);
---
>     notificationQueue = dispatch_queue_create("org.hammerspoon.Hammerspoon.gammaReapplyNotificationQueue", NULL);
