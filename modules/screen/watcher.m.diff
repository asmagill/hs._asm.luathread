4d3
< #import "../../LuaSkinThread.h"
21c20
< @interface LST_MJScreenWatcher : NSObject
---
> @interface MJScreenWatcher : NSObject
25d23
< @property NSThread *myMainThread ;
28,36c26
< @implementation LST_MJScreenWatcher
< - (instancetype)init {
<     self = [super init] ;
<     if (self) {
<         _myMainThread = [NSThread currentThread] ;
<     }
<     return self ;
< }
< 
---
> @implementation MJScreenWatcher
38,41c28,30
<     [self performSelector:@selector(screensChanged:)
<                  onThread:self.myMainThread
<                withObject:note
<             waitUntilDone:YES];
---
>     [self performSelectorOnMainThread:@selector(screensChanged:)
>                                         withObject:note
>                                         waitUntilDone:YES];
45c34
<     LuaSkin *skin = LST_getLuaSkin();
---
>     LuaSkin *skin = [LuaSkin shared];
49c38
<     [skin pushLuaRef:LST_getRefTable(skin, USERDATA_TAG, refTable) ref:self.fn];
---
>     [skin pushLuaRef:refTable ref:self.fn];
88c77
<     LuaSkin *skin = LST_getLuaSkin();
---
>     LuaSkin *skin = [LuaSkin shared];
96c85
<     screenwatcher->fn = [skin luaRef:LST_getRefTable(skin, USERDATA_TAG, refTable)];
---
>     screenwatcher->fn = [skin luaRef:refTable];
98c87
<     LST_MJScreenWatcher* object = [[LST_MJScreenWatcher alloc] init];
---
>     MJScreenWatcher* object = [[MJScreenWatcher alloc] init];
126c115
<     LuaSkin *skin = LST_getLuaSkin();
---
>     LuaSkin *skin = [LuaSkin shared];
133c122
<     ((__bridge LST_MJScreenWatcher *)screenwatcher->obj).includeActive = YES;
---
>     ((__bridge MJScreenWatcher *)screenwatcher->obj).includeActive = YES;
157c146
<     if (((__bridge LST_MJScreenWatcher *)screenwatcher->obj).includeActive) {
---
>     if (((__bridge MJScreenWatcher *)screenwatcher->obj).includeActive) {
185c174
<     if (((__bridge LST_MJScreenWatcher *)screenwatcher->obj).includeActive) {
---
>     if (((__bridge MJScreenWatcher *)screenwatcher->obj).includeActive) {
194c183
<     LuaSkin *skin = LST_getLuaSkin();
---
>     LuaSkin *skin = [LuaSkin shared];
200c189
<     screenwatcher->fn = [skin luaUnref:LST_getRefTable(skin, USERDATA_TAG, refTable) ref:screenwatcher->fn];
---
>     screenwatcher->fn = [skin luaUnref:refTable ref:screenwatcher->fn];
202c191
<     LST_MJScreenWatcher* object = (__bridge_transfer id)screenwatcher->obj;
---
>     MJScreenWatcher* object = (__bridge_transfer id)screenwatcher->obj;
240,245c229,230
<     LuaSkin *skin = LST_getLuaSkin();
<     LST_setRefTable(skin, USERDATA_TAG, refTable,
<         [skin registerLibraryWithObject:USERDATA_TAG
<                               functions:screenLib
<                           metaFunctions:meta_gcLib
<                         objectFunctions:screen_metalib]) ;
---
>     LuaSkin *skin = [LuaSkin shared];
>     refTable = [skin registerLibraryWithObject:USERDATA_TAG functions:screenLib metaFunctions:meta_gcLib objectFunctions:screen_metalib];
