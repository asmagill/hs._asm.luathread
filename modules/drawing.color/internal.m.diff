1,4c1
< #import <Cocoa/Cocoa.h>
< #import <Carbon/Carbon.h>
< #import <LuaSkin/LuaSkin.h>
< #import "../../LuaSkinThread.h"
---
> #import "../drawing.h"
6d2
< #define USERDATA_TAG "hs.drawing.color"
25c21
<     [LST_getLuaSkin() checkArgs:LS_TBREAK] ;
---
>     [[LuaSkin shared] checkArgs:LS_TBREAK] ;
29c25
<         [LST_getLuaSkin() pushNSObject:colorList] ;
---
>         [[LuaSkin shared] pushNSObject:colorList] ;
48,49c44,45
<     [LST_getLuaSkin() checkArgs:LS_TTABLE, LS_TBREAK] ;
<     NSColor *theColor = [LST_getLuaSkin() luaObjectAtIndex:1 toClass:"NSColor"] ;
---
>     [[LuaSkin shared] checkArgs:LS_TTABLE, LS_TBREAK] ;
>     NSColor *theColor = [[LuaSkin shared] luaObjectAtIndex:1 toClass:"NSColor"] ;
79,80c75,76
<     [LST_getLuaSkin() checkArgs:LS_TTABLE, LS_TBREAK] ;
<     NSColor *theColor = [LST_getLuaSkin() luaObjectAtIndex:1 toClass:"NSColor"] ;
---
>     [[LuaSkin shared] checkArgs:LS_TTABLE, LS_TBREAK] ;
>     NSColor *theColor = [[LuaSkin shared] luaObjectAtIndex:1 toClass:"NSColor"] ;
97c93
< // [LST_getLuaSkin() pushNSObject:NSColor]
---
> // [[LuaSkin shared] pushNSObject:NSColor]
113c109
<           [LST_getLuaSkin() pushNSObject:[theColor catalogNameComponent]] ;
---
>           [[LuaSkin shared] pushNSObject:[theColor catalogNameComponent]] ;
115c111
<           [LST_getLuaSkin() pushNSObject:[theColor colorNameComponent]] ;
---
>           [[LuaSkin shared] pushNSObject:[theColor colorNameComponent]] ;
125c121
< // [LST_getLuaSkin() pushNSObject:NSColorList]
---
> // [[LuaSkin shared] pushNSObject:NSColorList]
133c129
<         [LST_getLuaSkin() pushNSObject:[colorList colorWithKey:key]] ;
---
>         [[LuaSkin shared] pushNSObject:[colorList colorWithKey:key]] ;
142c138
<     LuaSkin *skin = LST_getLuaSkin() ;
---
>     LuaSkin *skin = [LuaSkin shared] ;
202,203c198,199
<             if (LST_getRefForLabel(skin, USERDATA_TAG, "colorCollectionsTable", colorCollectionsTable) != LUA_NOREF) {
<                 [skin pushLuaRef:LST_getRefTable(skin, USERDATA_TAG, refTable) ref:LST_getRefForLabel(skin, USERDATA_TAG, "colorCollectionsTable", colorCollectionsTable)] ;
---
>             if (colorCollectionsTable != LUA_NOREF) {
>                 [skin pushLuaRef:refTable ref:colorCollectionsTable] ;
230c226
< // [LST_getLuaSkin() luaObjectAtIndex:idx toClass:"NSColor"]
---
> // [[LuaSkin shared] luaObjectAtIndex:idx toClass:"NSColor"]
239,240c235
<     LuaSkin *skin = LST_getLuaSkin() ;
<     [skin checkArgs:LS_TTABLE, LS_TBREAK] ;
---
>     [[LuaSkin shared] checkArgs:LS_TTABLE, LS_TBREAK] ;
243,245c238
<     LST_setRefForLabel(skin, USERDATA_TAG, "colorCollectionsTable", colorCollectionsTable,
<         [skin luaRef:LST_getRefTable(skin, USERDATA_TAG, refTable)]) ;
< 
---
>     colorCollectionsTable = [[LuaSkin shared] luaRef:refTable] ;
260,265c253,255
<     LuaSkin *skin = LST_getLuaSkin();
<     LST_setRefTable(skin, USERDATA_TAG, refTable,
<         [skin registerLibrary:moduleLib
<                 metaFunctions:nil]) ; // or module_metaLib
< 
<     LST_setRefForLabel(skin, USERDATA_TAG, "colorCollectionsTable", colorCollectionsTable, LUA_NOREF) ;
---
>     LuaSkin *skin = [LuaSkin shared];
>     refTable = [skin registerLibrary:moduleLib metaFunctions:nil] ; // or module_metaLib
>     colorCollectionsTable = LUA_NOREF ;
